p8105\_hw5\_lg3158
================
Ling
11/12/2021

## Problem 1

``` r
q1_df = 
  read_csv(url("https://github.com/washingtonpost/data-homicides/raw/master/homicide-data.csv")) %>%
  mutate(city_state = paste(city, state, sep = ","))
```

    ## Rows: 52179 Columns: 12

    ## -- Column specification --------------------------------------------------------
    ## Delimiter: ","
    ## chr (9): uid, victim_last, victim_first, victim_race, victim_age, victim_sex...
    ## dbl (3): reported_date, lat, lon

    ## 
    ## i Use `spec()` to retrieve the full column specification for this data.
    ## i Specify the column types or set `show_col_types = FALSE` to quiet this message.

-   The data have 52179 observations and 13 variables (city,
    city\_state, disposition, lat, lon, reported\_date, state, uid,
    victim\_age, victim\_first, victim\_last, victim\_race, victim\_sex)
    after create the `city_state` variable.
-   Summarize total homicide and unsolved homicide
    -   create a data summarize total homicide number by city
    -   create a data only including the unsolved homicide, and
        summarize the total number by city
    -   combine the 2 data by city

``` r
q1_tot = q1_df %>%
  group_by(city_state) %>%
  summarise(total = n())

q1_unsolved = q1_df %>%
  filter(disposition %in% c("Closed without arrest","Open/no arrest")) %>%
  group_by(city_state) %>%
  summarise(unsolved = n())

q1_summary = left_join(q1_tot, q1_unsolved, by = "city_state")

knitr::kable(q1_summary)
```

| city\_state       | total | unsolved |
|:------------------|------:|---------:|
| Albuquerque,NM    |   378 |       52 |
| Atlanta,GA        |   973 |       58 |
| Baltimore,MD      |  2827 |      152 |
| Baton Rouge,LA    |   424 |       16 |
| Birmingham,AL     |   800 |       64 |
| Boston,MA         |   614 |       NA |
| Buffalo,NY        |   521 |        8 |
| Charlotte,NC      |   687 |       44 |
| Chicago,IL        |  5535 |      387 |
| Cincinnati,OH     |   694 |       49 |
| Columbus,OH       |  1084 |       80 |
| Dallas,TX         |  1567 |       78 |
| Denver,CO         |   312 |       46 |
| Detroit,MI        |  2519 |       16 |
| Durham,NC         |   276 |       11 |
| Fort Worth,TX     |   549 |       35 |
| Fresno,CA         |   487 |       23 |
| Houston,TX        |  2942 |      346 |
| Indianapolis,IN   |  1322 |      102 |
| Jacksonville,FL   |  1168 |      141 |
| Kansas City,MO    |  1190 |       36 |
| Las Vegas,NV      |  1381 |      175 |
| Long Beach,CA     |   378 |       27 |
| Los Angeles,CA    |  2257 |       NA |
| Louisville,KY     |   576 |       NA |
| Memphis,TN        |  1514 |       50 |
| Miami,FL          |   744 |       63 |
| Milwaukee,wI      |  1115 |       37 |
| Minneapolis,MN    |   366 |       31 |
| Nashville,TN      |   767 |       57 |
| New Orleans,LA    |  1434 |       98 |
| New York,NY       |   627 |       17 |
| Oakland,CA        |   947 |       NA |
| Oklahoma City,OK  |   672 |       11 |
| Omaha,NE          |   409 |       10 |
| Philadelphia,PA   |  3037 |       92 |
| Phoenix,AZ        |   914 |       96 |
| Pittsburgh,PA     |   631 |       NA |
| Richmond,VA       |   429 |       20 |
| Sacramento,CA     |   376 |       23 |
| San Antonio,TX    |   833 |       87 |
| San Bernardino,CA |   275 |       19 |
| San Diego,CA      |   461 |       64 |
| San Francisco,CA  |   663 |        1 |
| Savannah,GA       |   246 |       12 |
| St. Louis,MO      |  1677 |       40 |
| Stockton,CA       |   444 |       11 |
| Tampa,FL          |   208 |        8 |
| Tulsa,AL          |     1 |       NA |
| Tulsa,OK          |   583 |       55 |
| Washington,DC     |  1345 |       74 |

-   `prop.test`
    -   Baltimore result

``` r
q1_balt =
  prop.test(pull(subset(q1_summary, city_state == "Baltimore,MD"),unsolved), 
            pull(subset(q1_summary, city_state == "Baltimore,MD"),total)) %>%
  broom::tidy() %>%
  mutate(city_state = "Baltimore,MD") %>%
  select(city_state, estimate, conf.low, conf.high)
knitr::kable(q1_balt)
```

| city\_state  |  estimate | conf.low | conf.high |
|:-------------|----------:|---------:|----------:|
| Baltimore,MD | 0.0537672 | 0.045878 | 0.0628933 |

-   all other cities result

``` r
fx_proc = function(dat)
  {
  if (is.na(dat$unsolved))
  {
    return(c(NA, NA, NA))
  }
  
  prop = prop.test(dat$unsolved, dat$total) %>%
    broom::tidy() %>%
    select(estimate, conf.low, conf.high)
  return(prop)
}

q1_list = 
  nest(q1_summary, data = total:unsolved)

q1_list_result = q1_list %>%
mutate(result = map(q1_list$data, fx_proc)) %>%
  unnest(cols = c(data, result)) %>%
  select(-result)

knitr::kable(q1_list_result)
```

| city\_state       | total | unsolved |  estimate |  conf.low | conf.high |
|:------------------|------:|---------:|----------:|----------:|----------:|
| Albuquerque,NM    |   378 |       52 | 0.1375661 | 0.1053008 | 0.1773988 |
| Atlanta,GA        |   973 |       58 | 0.0596095 | 0.0459409 | 0.0768603 |
| Baltimore,MD      |  2827 |      152 | 0.0537672 | 0.0458780 | 0.0628933 |
| Baton Rouge,LA    |   424 |       16 | 0.0377358 | 0.0224545 | 0.0618420 |
| Birmingham,AL     |   800 |       64 | 0.0800000 | 0.0625900 | 0.1015566 |
| Boston,MA         |   614 |       NA |        NA |        NA |        NA |
| Boston,MA         |   614 |       NA |        NA |        NA |        NA |
| Boston,MA         |   614 |       NA |        NA |        NA |        NA |
| Buffalo,NY        |   521 |        8 | 0.0153551 | 0.0071571 | 0.0312566 |
| Charlotte,NC      |   687 |       44 | 0.0640466 | 0.0474251 | 0.0857068 |
| Chicago,IL        |  5535 |      387 | 0.0699187 | 0.0634083 | 0.0770336 |
| Cincinnati,OH     |   694 |       49 | 0.0706052 | 0.0531888 | 0.0929259 |
| Columbus,OH       |  1084 |       80 | 0.0738007 | 0.0592815 | 0.0914187 |
| Dallas,TX         |  1567 |       78 | 0.0497766 | 0.0397807 | 0.0620395 |
| Denver,CO         |   312 |       46 | 0.1474359 | 0.1109797 | 0.1928135 |
| Detroit,MI        |  2519 |       16 | 0.0063517 | 0.0037624 | 0.0105378 |
| Durham,NC         |   276 |       11 | 0.0398551 | 0.0210916 | 0.0722013 |
| Fort Worth,TX     |   549 |       35 | 0.0637523 | 0.0454232 | 0.0884103 |
| Fresno,CA         |   487 |       23 | 0.0472279 | 0.0308453 | 0.0710756 |
| Houston,TX        |  2942 |      346 | 0.1176071 | 0.1062996 | 0.1299264 |
| Indianapolis,IN   |  1322 |      102 | 0.0771558 | 0.0636206 | 0.0932054 |
| Jacksonville,FL   |  1168 |      141 | 0.1207192 | 0.1028691 | 0.1411126 |
| Kansas City,MO    |  1190 |       36 | 0.0302521 | 0.0215767 | 0.0420793 |
| Las Vegas,NV      |  1381 |      175 | 0.1267198 | 0.1098644 | 0.1456886 |
| Long Beach,CA     |   378 |       27 | 0.0714286 | 0.0484586 | 0.1034529 |
| Los Angeles,CA    |  2257 |       NA |        NA |        NA |        NA |
| Los Angeles,CA    |  2257 |       NA |        NA |        NA |        NA |
| Los Angeles,CA    |  2257 |       NA |        NA |        NA |        NA |
| Louisville,KY     |   576 |       NA |        NA |        NA |        NA |
| Louisville,KY     |   576 |       NA |        NA |        NA |        NA |
| Louisville,KY     |   576 |       NA |        NA |        NA |        NA |
| Memphis,TN        |  1514 |       50 | 0.0330251 | 0.0248531 | 0.0436466 |
| Miami,FL          |   744 |       63 | 0.0846774 | 0.0661465 | 0.1076173 |
| Milwaukee,wI      |  1115 |       37 | 0.0331839 | 0.0237904 | 0.0459178 |
| Minneapolis,MN    |   366 |       31 | 0.0846995 | 0.0591627 | 0.1192699 |
| Nashville,TN      |   767 |       57 | 0.0743155 | 0.0572256 | 0.0957959 |
| New Orleans,LA    |  1434 |       98 | 0.0683403 | 0.0560831 | 0.0829652 |
| New York,NY       |   627 |       17 | 0.0271132 | 0.0163803 | 0.0439566 |
| Oakland,CA        |   947 |       NA |        NA |        NA |        NA |
| Oakland,CA        |   947 |       NA |        NA |        NA |        NA |
| Oakland,CA        |   947 |       NA |        NA |        NA |        NA |
| Oklahoma City,OK  |   672 |       11 | 0.0163690 | 0.0086312 | 0.0300135 |
| Omaha,NE          |   409 |       10 | 0.0244499 | 0.0124719 | 0.0459676 |
| Philadelphia,PA   |  3037 |       92 | 0.0302931 | 0.0246174 | 0.0371874 |
| Phoenix,AZ        |   914 |       96 | 0.1050328 | 0.0862828 | 0.1271795 |
| Pittsburgh,PA     |   631 |       NA |        NA |        NA |        NA |
| Pittsburgh,PA     |   631 |       NA |        NA |        NA |        NA |
| Pittsburgh,PA     |   631 |       NA |        NA |        NA |        NA |
| Richmond,VA       |   429 |       20 | 0.0466200 | 0.0294550 | 0.0722913 |
| Sacramento,CA     |   376 |       23 | 0.0611702 | 0.0400270 | 0.0916663 |
| San Antonio,TX    |   833 |       87 | 0.1044418 | 0.0849119 | 0.1277075 |
| San Bernardino,CA |   275 |       19 | 0.0690909 | 0.0432346 | 0.1075215 |
| San Diego,CA      |   461 |       64 | 0.1388286 | 0.1092658 | 0.1745643 |
| San Francisco,CA  |   663 |        1 | 0.0015083 | 0.0000787 | 0.0097368 |
| Savannah,GA       |   246 |       12 | 0.0487805 | 0.0266293 | 0.0858137 |
| St. Louis,MO      |  1677 |       40 | 0.0238521 | 0.0173115 | 0.0326569 |
| Stockton,CA       |   444 |       11 | 0.0247748 | 0.0130803 | 0.0452304 |
| Tampa,FL          |   208 |        8 | 0.0384615 | 0.0179931 | 0.0771210 |
| Tulsa,AL          |     1 |       NA |        NA |        NA |        NA |
| Tulsa,AL          |     1 |       NA |        NA |        NA |        NA |
| Tulsa,AL          |     1 |       NA |        NA |        NA |        NA |
| Tulsa,OK          |   583 |       55 | 0.0943396 | 0.0724405 | 0.1217397 |
| Washington,DC     |  1345 |       74 | 0.0550186 | 0.0437194 | 0.0689291 |

-   plot for unsolved homicide cases

``` r
q1_plot = q1_list_result %>%
  ggplot(aes(x = city_state, y = estimate*100)) +
    geom_bar(stat = "identity") +
    geom_errorbar(aes(ymin = conf.low*100, ymax = conf.high*100), stat = "identity") +
    labs(title = "Unsolved homicide proportions",
         x = "City, state",
         y = "Unsolved case(%)") +
  coord_flip()

q1_plot
```

    ## Warning: Removed 18 rows containing missing values (position_stack).

![](p8105_hw5_lg3158_files/figure-gfm/unnamed-chunk-5-1.png)<!-- -->

## Problem 2
